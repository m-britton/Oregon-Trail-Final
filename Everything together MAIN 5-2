import androidx.appcompat.app.AppCompatActivity;

import android.graphics.Color;
import android.media.Image;
import android.os.Bundle;

import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.LinearLayout;
import android.widget.QuickContactBadge;
import android.widget.TextView;
import android.media.AudioManager;
import android.media.MediaPlayer;
import android.widget.ImageView;

import org.w3c.dom.Text;

public class MainActivity extends AppCompatActivity {

    //Creation of classes used.
    RandomEvents re = new RandomEvents();
    Health health = new Health();
    Location location = new Location(0, 1, 1, 140, 100, 300);
    Shop shop = new Shop();
    River river = new River();
    Story story = new Story();
    Weather weather = new Weather();
    Women women = new Women();
    Wagon wagon = new Wagon(shop.food_Price / .1, shop.clothing_Price / .2, shop.weapons_Price / 20, shop.oxen_Price / 50, shop.spareWagonWheel_Price / 8, shop.spareWagonAxel_Price / 3, shop.spareWagonTongues_Price / 3, shop.medicalSupplyBox_Price / 1.5, shop.sewingKit_Price / .50, shop.fireStartingKit_Price / .25, shop.kidsToys_Price / .05, 1, shop.seedPackeges_Price / .01, shop.shovels_Price / 2.5, shop.cookingItems_Price / 1.5);
    MediaPlayer mp;
    MediaPlayer st;
    MediaPlayer rs;
    MediaPlayer tt;

    public boolean wagonMade = true;
    public boolean mtIsPlaying = false;
    public int resetDay = 0;
    String rations = "";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        final TextView display = findViewById(R.id.Display);
        final Button nextDay = findViewById(R.id.button);
        final TextView date = findViewById(R.id.Date);
        final TextView foodBox = findViewById(R.id.foodRemaining);
        final TextView healthBox = findViewById(R.id.healthBox);
        final TextView reBox = findViewById((R.id.REbox));
        final Button confirm = findViewById(R.id.confirm);
        final EditText User_InputBox = findViewById(R.id.UserInput);
        final TextView shopDisplay = findViewById(R.id.shopDisplay);
        final ImageView picture = findViewById(R.id.imageView);
        final Button enterShop = findViewById(R.id.enterShop);
        final Button leaveShop = findViewById(R.id.leaveShop);
        final TextView weatherBox = findViewById(R.id.weatherBox);
        final TextView sickBox = findViewById(R.id.sickBox);
        final ImageView title = findViewById(R.id.fullImage);
        final Button play = findViewById(R.id.playGame);
        final Button credits = findViewById(R.id.credits);
        final TextView storyDisplay = findViewById(R.id.storyDisplay);

        //This is to change background color in order to do so use .setBackgroundColor()
        final LinearLayout background = findViewById(R.id.linear);

        //Array of images, images made be added as needed
        final int a[] = {R.drawable.shoppingpic, R.drawable.traveling, R.drawable.hattiecampbell,
                R.drawable.oregonstart, R.drawable.chimneyrock, R.drawable.forthall, R.drawable.fortboise,
                R.drawable.fortkearney, R.drawable.fortwallawalla, R.drawable.laramie, R.drawable.sodaspring,
                R.drawable.southpass, R.drawable.thedalles, R.drawable.oregoncity, R.drawable.map};

        //Creates a media player for main theme
        mp = MediaPlayer.create(this, R.raw.maintune);
        st = MediaPlayer.create(this, R.raw.shoptune);
        rs = MediaPlayer.create(this, R.raw.rivertune);
        tt = MediaPlayer.create(this, R.raw.towntune);

        //Put title image and button in front
        title.bringToFront();
        play.bringToFront();
        credits.bringToFront();

        //Make display visible until used.
        display.setVisibility(View.INVISIBLE);

        //When clicked removes title screen and prompts user to enter shop
        play.setOnClickListener(new View.OnClickListener()  {

            public void onClick(View v)
            {
                //Sets various gui parts to invisible to reveal a new scene
                title.setVisibility(View.INVISIBLE);
                play.setVisibility(View.INVISIBLE);
                credits.setVisibility(View.INVISIBLE);
                leaveShop.setVisibility(View.INVISIBLE);
                storyDisplay.setVisibility(View.INVISIBLE);

                //allows player to enter shop if at a town
                if(location.getAtTown())
                {
                    enterShop.setVisibility(View.VISIBLE);
                }
                //Hides next day button if not at a river. but reveals it if at river
                if(!location.getAtRiver())
                {
                    nextDay.setVisibility(View.INVISIBLE);
                }
                else
                {
                    nextDay.setVisibility(View.VISIBLE);
                }

                location.setAtLandmark(false);
                location.setAtRiver(false);
                location.setAtTown(false);

                //if river theme is playing this stops it
                rs.pause();

            }

        });


        credits.setOnClickListener(new View.OnClickListener()  {

            public void onClick(View v)
            {
                title.setImageResource(R.drawable.credits);
            }
        });

        //When clicked takes player to shop
        enterShop.setOnClickListener(new View.OnClickListener() {

            public void onClick(View v) {
                //Sets store layout along with making everything invisible until leaving the shop
                shopDisplay.setText(shop.storeLayout());
                enterShop.setVisibility(View.INVISIBLE);
                reBox.setVisibility(View.INVISIBLE);
                date.setVisibility(View.INVISIBLE);
                healthBox.setVisibility(View.INVISIBLE);

                leaveShop.setVisibility(View.VISIBLE);
                User_InputBox.setVisibility(View.VISIBLE);
                //Changes music
                st.start();

                //Changes image to that of the shopping area
                picture.setImageResource(R.drawable.shoppingpic);
            }
        });

        leaveShop.setOnClickListener(new View.OnClickListener() {

            public void onClick(View v) {
                //shopDisplay.setVisibility(View.INVISIBLE);
                shopDisplay.setVisibility(View.INVISIBLE);
                reBox.setVisibility(View.VISIBLE);
                date.setVisibility(View.VISIBLE);
                healthBox.setVisibility(View.VISIBLE);
                leaveShop.setVisibility(View.INVISIBLE);
                confirm.setVisibility(View.INVISIBLE);
                User_InputBox.setVisibility(View.INVISIBLE);
                nextDay.setVisibility(View.VISIBLE);
                foodBox.setVisibility(View.VISIBLE);

                //Changes back to Hattie's pic
                picture.setImageResource(R.drawable.hattiecampbell);
            }
        });

        confirm.setOnClickListener(new View.OnClickListener() {

            public void onClick(View v) {

                // Get the users input from the text box and convert to a string.
                String input = User_InputBox.getText().toString();

                // If the user decides to buy items then the item bought and the price owed for the item are updated.
                if(shop.buying)
                {
                    String boughtItem = shop.buyItem(input);
                    shopDisplay.setText(boughtItem);
                }
                else
                {
                    shop.calcBoughtItem(shop.otherinput, Integer.parseInt(input));
                }

            }

        });

        // Actions occur when the Next Day button is clicked.
        nextDay.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {

                //Switches and removes all necessary aesthetics
                confirm.setVisibility(View.INVISIBLE);
                User_InputBox.setVisibility(View.INVISIBLE);
                leaveShop.setVisibility(View.INVISIBLE);
                st.stop();
                //Changes images to oregon start
                picture.setImageResource(R.drawable.oregonstart);
                //Starts the mt if it is not playing
                if (mtIsPlaying = false) {
                    mp.start();
                    mtIsPlaying = true;
                }
                mp.start();


                //Changes the variables in the wagon class based upon purchased items.
                if (wagonMade) {
                    wagon = new Wagon(shop.food_Price / .1, shop.clothing_Price / .2, shop.weapons_Price / 20, shop.oxen_Price / 50, shop.spareWagonWheel_Price / 8, shop.spareWagonAxel_Price / 3, shop.spareWagonTongues_Price / 3, shop.medicalSupplyBox_Price / 1.5, shop.sewingKit_Price / .50, shop.fireStartingKit_Price / .25, shop.kidsToys_Price / .05, 1, shop.seedPackeges_Price / .01, shop.shovels_Price / 2.5, shop.cookingItems_Price / 1.5);
                    wagonMade = false;
                }

                //Resets display in case no location is reached.
                display.setText("");
                shopDisplay.setText("");

                // Reset the number of days that the group loses due to random events and keeps pace set to zero
                if(resetDay > 0){
                    location.setPace(0);
                    resetDay--;
                }
                // If no random event has effects the travel time set pace to 1
                else{
                    location.setPace(1);
                }

                /* Location based classes that happen everytime a button is clicked.
                    Every button click adds 1 day and changes months if appropriate.
                    checks if the player has reached a river, town, or landmark.
                    Decreases distance of player form river, town, and landmarks.
                */
                location.locationFromPace(location.getPace(), health.getTotalOxen(), health.getSickPeople(), weather.getTotalSnow(), location.whatLandmark());
                location.incrementDay();
                location.setDistanceToLandmark(location.getDistanceToLandmark() - 20);
                location.setDistanceToRiver(location.getDistanceToRiver() - 20);
                location.setDistanceToTown(location.getDistanceToTown() - 20);

                location.atLandmark();

                //Displays town image if the person is at a town based upon which town. If true resets distance to next landmark.
                if (location.getAtTown()) {
                    display.setText("You are at town " + location.whatTown());

                    switch(location.getTownsVisited()) {
                        case 1:
                            title.setImageResource(R.drawable.fortkearney);
                            break;
                        case 2:
                            title.setImageResource(R.drawable.laramie);
                            break;
                        case 3:
                            title.setImageResource(R.drawable.fortbridger);
                            break;
                        case 4:
                            title.setImageResource(R.drawable.forthall);
                            break;
                        case 5:
                            title.setImageResource(R.drawable.fortboise);
                            break;
                        case 6:
                            title.setImageResource(R.drawable.fortwallawalla);
                            break;
                        case 7:
                            title.setImageResource(R.drawable.oregoncity);
                        default:
                            break;
                    }
                    title.setVisibility(View.VISIBLE);
                    play.setVisibility(View.VISIBLE);
                    play.setText("Enter Town");
                    nextDay.setVisibility(View.INVISIBLE);
                    mp.pause();
                    tt.start();

                    title.bringToFront();
                    storyDisplay.setVisibility(View.VISIBLE);
                    storyDisplay.bringToFront();
                    storyDisplay.setText(story.storyTowns(location.whatTown()));

                    location.setDistanceToTown(200);
                }
                //If the player is at a river changes gui accordingly
                if (location.getAtRiver()) {
                    display.setText("You are at a river");

                    title.setImageResource(R.drawable.river);

                    title.setVisibility(View.VISIBLE);
                    play.setVisibility(View.VISIBLE);
                    play.setText("Cross River");
                    nextDay.setVisibility(View.INVISIBLE);
                    //nextDay.setVisibility(View.INVISIBLE);
                    mp.pause();
                    rs.start();

                    location.setDistanceToRiver(100);
                    //location.setAtRiver(false);
                }

                //if player is at a landmark changes gui accordingly
                if (location.getAtLandmark()) {
                    display.setText("You are at " + location.whatLandmark());

                    title.setVisibility(View.VISIBLE);
                    play.setVisibility(View.VISIBLE);
                    play.setText("Leave");
                    switch(location.getLandmarksVisited())
                    {
                        case 1:
                            title.setImageResource(R.drawable.chimneyrock);
                            break;
                        case 2:
                            title.setImageResource(R.drawable.independencerock);
                            break;
                        case 3:
                            title.setImageResource(R.drawable.southpass);
                            break;
                        case 4:
                            title.setImageResource(R.drawable.sodaspring);
                            break;
                        case 5:
                            title.setImageResource(R.drawable.bluemountains);
                            break;
                        case 6:
                            title.setImageResource(R.drawable.thedalles);
                            break;
                        default:
                            break;

                    }
                    storyDisplay.setText(story.storyLandmarks(location.whatLandmark()));
                    storyDisplay.setVisibility(View.VISIBLE);
                    storyDisplay.bringToFront();

                    location.setDistanceToLandmark(300);
                    location.setAtLandmark(false);
                }


                // display the weather for the day to the user, using the getTemperature method
                weatherBox.setText(weather.displayTemperature(weather.getTemperature(location.getZone(), location.getMonth()))
                        + " " + weather.totalRainfall(location.getZone(), location.getMonth()));

                /* Change the background color depending on the weather
                   White if there is snow
                   Orange for drought
                   Blue for good weather
                 */
                if(weather.getTotalSnow() >= 1){
                    background.setBackgroundColor(1243);
                }
                else if(weather.getTotalRain() <= 0.2){
                    background.setBackgroundColor(Color.rgb(255, 165, 0));
                }
                else{
                    background.setBackgroundColor(Color.rgb(0, 100, 100));
                }

//                //Displays a message if the person is at a town. If true resets distance to next landmark.
//                if (location.getAtTown()) {
//                    display.setText("You are at town " + location.whatTown());
//                    location.setDistanceToTown(200);
//                    location.setAtTown(false);
//                }
//                if (location.getAtRiver()) {
//                    display.setText("You are at a river");
//                    location.setDistanceToRiver(100);
//                    location.setAtRiver(false);
//                }
//                if (location.getAtLandmark()) {
//                    display.setText("You are at " + location.whatLandmark());
//                    location.setDistanceToLandmark(300);
//                    location.setAtLandmark(false);
//                }


                // restore 10 percent of the total health for resting over night
                health.startOfDayHealth();

                // A party member is only sick for ten days, each day the total numbers of days sick is decreased
                health.resetDaysSick();

                /*
                Use the random event method for someone getting sick.
                If it is true, randomly generate the person and the disease contracted.
                Update the variable that tracks the health of that person.
                Display to the user that someone has become ill.
                If the person dies display that to the user.
                Set the number of days the person is sick for to ten.
                 */
                if(re.illness(health.getHealth())){
                    String disease = health.randomDisease();
                    String person = health.randomPerson();
                    health.sickPerson(person);
                    String sickMessage = person + " has contracted " + disease;
                    health.addHealth(20);
                    sickBox.setText(sickMessage);
                    if(health.personHasDied(person)) {
                        sickBox.setText(health.personDeath(person));
                    }
                    health.setDaysSick(person);
                }

                /*
                When there are more than two people that are sick the women play with the children.
                Playing with the children makes recovery quicker, and benefits teh overall health of the group
                 */
                if(health.getSickPeople() > 2){
                    if(wagon.getKidsToys() > 0) {
                        women.playWithKids();
                        health.addHealth(-2);
                        health.resetDaysSick();
                    }
                }

                /*
                Once a week each month the women cook more food for their families to eat.
                When they cook an extra 20 pounds of food is added to the total amount of food.
                 */
                if(location.getDay() % 7 == 0) {
                    if(wagon.getCookingItems() > 0) {
                        women.cookFood();
                    }
                }

                /*
                When the amount of food remaining in the wagon gets below 300 pounds or if there are
                less than 3 cooking items the women go foraging for more. A random amount of food
                and cooking supplies gets added to the total amount.
                 */
                if(wagon.getFood() < 300 || wagon.getCookingItems() < 3) {
                    women.forageFood();
                }

                /*
                When the party has run out of adequate clothing the women of the group will restore the clothing.
                The group loses a sewing kit but gains 2 items of clothing.
                 */
                if(wagon.getClothing() < 1){
                    if(wagon.getSewingKit() > 1){
                        women.restoreClothing();
                    }
                }

                // add one for each party member that is sick
                health.addHealth(health.getSickPeople());

                // Reset the amount of accumulated precipitation.
                weather.resetRain();
                weather.resetSnow();


                /* Find whether or not a random event occurs each day.
                    If a random event takes place a prompt appears for the user to see what happened
                    If someone gets bit by a snake the overall health goes up by 10
                    If Indians help you find food the amount of food goes up 8 pounds
                    If you take the wrong trail you have to back track using vital supplies
                    Otherwise they message "It was a normal day" appears
                 */
                if (re.snakeBite()) {
                    health.addHealth(10);
                    String person = health.randomPerson();
                    health.sickPerson(person);
                    reBox.setText(person + " got bit by a snake");
                }
                else if (re.indiansHelpFindFood()) {
                    wagon.setFood(wagon.getFood() + 30);
                    reBox.setText("Indians helped you find food");
                }
                else if (re.wrongTrail()) {
                    reBox.setText("OH-NO you took the wrong trail");
                    resetDay += 3;
                }
                else if (re.lostTrail()) {
                    reBox.setText("You lost the trail");
                    resetDay += 5;
                }
                else if (re.wagonFire()) {
                    reBox.setText("THe wagon caught on fire!!");
                }
                else if (re.lostPerson()) {
                    reBox.setText("A member of your group is missing");
                    resetDay += 4;
                }
                else if (re.lostOxen()) {
                    reBox.setText("An oxen has wandered off.");
                    resetDay += 2;
                }
                else if (re.foundWagon()) {
                    reBox.setText("You found an abandoned wagon");
                    wagon.setFood(wagon.getFood() + 10);
                    wagon.setCookingItems(wagon.getCookingItems() + 3);
                    wagon.setKidsToys(wagon.getKidsToys() + 2);
                    wagon.setClothing(wagon.getClothing() + 2);
                }
                else if (re.robbedAtNight()) {
                    reBox.setText("You got robbed in the middle of the night");
                    wagon.setFood(wagon.getFood() - 10);
                    wagon.setSewingKit(wagon.getSewingKit() - 1);
                    wagon.setClothing(wagon.getClothing() - 3);
                }
                else {
                    reBox.setText("It was a normal day!");
                }

                // When the total accumulated rain is less than 0.1 inch drought occurs and its consequences are invoked.
                if (weather.getTotalRain() <= 0.1) {
                    // Check if there is bad water, very little water, or bad grass.
                    if (re.badWater()) {
                        // When there is bad water tell the user and add 20 to the groups overall health.
                        reBox.setText("The water is bad.");
                        health.addHealth(20);
                    } else if (re.littleWater()) {
                        // When there is very little water tell the user and add 10 to the overall health.
                        reBox.setText("There is very little water");
                        health.addHealth(10);
                    } else if (re.badGrass()) {
                        // When there is bad grass tell the user and ass 15 to the overall oxen health.
                        reBox.setText("The grass is inadequate.");
                        health.addOxenHealth(15);
                    }
                }

                // When the group is traveling between the months of May and September they can find wild fruit.
                if (location.getMonth() >= 5 && location.getMonth() <= 9) {
                    // When the group finds wild fruit tell the user and and add 20 pounds to the total food.
                    if (re.foundFruit()) {
                        reBox.setText("You found wild fruit");
                        wagon.setFood(wagon.getFood() + 20);
                    }
                }

                //Depending on how many pounds of food is remaining the ration qualification changes
                if (wagon.getFood() >= 1500) {
                    rations = "Filling";
                } else if (wagon.getFood() >= 1000) {
                    rations = "Meager";
                } else if (wagon.getFood() >= 500) {
                    rations = "Bare Bones";
                } else {
                    rations = "Out of food";
                }

                // Using the rations found above determine how the health is effected
                health.healthFromFood(rations);
                health.healthFromPace(location.getPace());
                health.healthFromWeather(weather.displayTemperature(weather.getRealTemp()), wagon.getClothing());

                wagon.setFood(wagon.getFood() - 20);

                // display to the user the overall health of the entire group
                healthBox.setText(health.generalHealth());
                foodBox.setText(Double.toString(wagon.getFood()));
                date.setText(location.whatMonth() + " " + location.getDay());
            }
        });

    }
}
