package com.example.mvporegontrailfinaliteration;

import androidx.appcompat.app.AppCompatActivity;

import android.media.Image;
import android.os.Bundle;

import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.LinearLayout;
import android.widget.TextView;
import android.media.AudioManager;
import android.media.MediaPlayer;
import android.widget.ImageView;

public class MainActivity extends AppCompatActivity {

    //Creation of classes used.
    RandomEvents re = new RandomEvents();
    Health overallHealth = new Health();
    Location location = new Location(0, 1, 1, 140, 100, 300);
    Shop shop = new Shop();
    Wagon wagon = new Wagon(shop.food_Price/.1, shop.clothing_Price/.2,shop.weapons_Price/20,shop.oxen_Price/50,shop.spareWagonWheel_Price/8,shop.spareWagonAxel_Price/3, shop.spareWagonTongues_Price/3, shop.medicalSupplyBox_Price/1.5, shop.sewingKit_Price/.50, shop.fireStartingKit_Price/.25, shop.kidsToys_Price/.05, 1, shop.seedPackeges_Price/.01, shop.shovels_Price/2.5, shop.cookingItems_Price/1.5);
    MediaPlayer mp;
    MediaPlayer st;
    MediaPlayer rs;
    MediaPlayer tt;

    //Checks if the wagon has been made for purposes of shopping
    public boolean wagonMade = true;
    //Checks if music is playing
    public boolean mtIsPlaying = false;

    String rations = "";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        final TextView display = findViewById(R.id.Display);
        final Button nextDay = findViewById(R.id.button);
        final TextView date = findViewById(R.id.Date);
        final TextView foodBox = findViewById(R.id.foodRemaining);
        final TextView healthBox = findViewById(R.id.healthBox);
        final TextView reBox = findViewById((R.id.REbox));
        final Button confirm = findViewById(R.id.confirm);
        final EditText User_InputBox = findViewById(R.id.UserInput);
        final TextView shopDisplay = findViewById(R.id.shopDisplay);
        final ImageView picture = findViewById(R.id.imageView);
        final Button enterShop = findViewById(R.id.enterShop);
        final Button leaveShop = findViewById(R.id.leaveShop);
        final ImageView title = findViewById(R.id.fullImage);
        final Button play = findViewById(R.id.playGame);
        final Button credits = findViewById(R.id.credits);
        //This is to change background color in order to do so use .setBackgroundColor()
        final LinearLayout background = findViewById(R.id.linear);

        //Array of images, images made be added as needed
        final int a[] = {R.drawable.shoppingpic, R.drawable.hattiecampbell, R.drawable.oregonstart, R.drawable.fortkearney, R.drawable.credits, R.drawable.river};

        //Creates a media player for main theme
        mp = MediaPlayer.create(this, R.raw.mt);
        st = MediaPlayer.create(this, R.raw.st);
        rs = MediaPlayer.create(this, R.raw.rs);
        tt = MediaPlayer.create(this, R.raw.tt);


        //puts the title image and button in front
        title.bringToFront();
        play.bringToFront();
        credits.bringToFront();



        //When clicked removes title screen and prompts user to enter shop
        play.setOnClickListener(new View.OnClickListener()  {

            public void onClick(View v)
            {
                //Sets various gui parts to invisible to reveal a new scene
                title.setVisibility(View.INVISIBLE);
                play.setVisibility(View.INVISIBLE);
                credits.setVisibility(View.INVISIBLE);
                leaveShop.setVisibility(View.INVISIBLE);

                //allows player to enter shop if at a town
                if(location.getAtTown())
                {
                    enterShop.setVisibility(View.VISIBLE);
                }
                //Hides next day button if not at a river
                if(!location.getAtRiver())
                {
                    nextDay.setVisibility(View.INVISIBLE);
                }

                location.setAtLandmark(false);
                location.setAtRiver(false);
                location.setAtTown(false);

                //if river theme is playing this stops it
                rs.pause();

            }

                                });


        credits.setOnClickListener(new View.OnClickListener()  {

            public void onClick(View v)
            {
                title.setImageResource(R.drawable.credits);
            }
                                   });

        //When clicked takes player to shop
        enterShop.setOnClickListener(new View.OnClickListener() {

        public void onClick(View v)
        {
            //Sets store layout along with making everything invisible until leaving the shop
            shopDisplay.setText(shop.storeLayout());
            enterShop.setVisibility(View.INVISIBLE);
            reBox.setVisibility(View.INVISIBLE);
            date.setVisibility(View.INVISIBLE);
            healthBox.setVisibility(View.INVISIBLE);

            leaveShop.setVisibility(View.VISIBLE);
            User_InputBox.setVisibility(View.VISIBLE);
            //Changes music
            st.start();

            //Changes image to that of the shopping area
            picture.setImageResource(R.drawable.shoppingpic);
        }
                                     });

        leaveShop.setOnClickListener(new View.OnClickListener() {

            public void onClick(View v)
            {
                shopDisplay.setVisibility(View.INVISIBLE);
                reBox.setVisibility(View.VISIBLE);
                date.setVisibility(View.VISIBLE);
                healthBox.setVisibility(View.VISIBLE);
                leaveShop.setVisibility(View.INVISIBLE);
                confirm.setVisibility(View.INVISIBLE);
                User_InputBox.setVisibility(View.INVISIBLE);
                nextDay.setVisibility(View.VISIBLE);

                //Changes back to Hattie's pic
                picture.setImageResource(R.drawable.hattiecampbell);
            }
                                     });

        confirm.setOnClickListener(new View.OnClickListener() {

            public void onClick(View v)
            {

                // Get the users input from the text box and convert to a string.
                String input = User_InputBox.getText().toString();

                // If the user decides to buy items then the item bought and the price owed for the item are updated.
                if(shop.buying)
                {
                    String boughtItem = shop.buyItem(input);
                    shopDisplay.setText(boughtItem);
                }
                else
                {
                    shop.calcBoughtItem(shop.otherinput, Integer.parseInt(input));
                    shopDisplay.setText(shop.storeShelf);
                }
            }

        });

        // Actions occur when the Next Day button is clicked.
        nextDay.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {

                //Switches and removes all necessary aesthetics
                confirm.setVisibility(View.INVISIBLE);
                User_InputBox.setVisibility(View.INVISIBLE);
                leaveShop.setVisibility(View.INVISIBLE);
                st.stop();
                //Changes images to oregon start
                picture.setImageResource(R.drawable.oregonstart);
                //Starts the mt if it is not playing
                if(mtIsPlaying = false)
                {
                    mp.start();
                    mtIsPlaying = true;
                }
                mp.start();


                //Changes the variables in the wagon class based upon purchased items.
                if(wagonMade) {
                    wagon = new Wagon(shop.food_Price / .1, shop.clothing_Price / .2, shop.weapons_Price / 20, shop.oxen_Price / 50, shop.spareWagonWheel_Price / 8, shop.spareWagonAxel_Price / 3, shop.spareWagonTongues_Price / 3, shop.medicalSupplyBox_Price / 1.5, shop.sewingKit_Price / .50, shop.fireStartingKit_Price / .25, shop.kidsToys_Price / .05, 1, shop.seedPackeges_Price / .01, shop.shovels_Price / 2.5, shop.cookingItems_Price / 1.5);
                wagonMade = false;
                }

                //Resets display in case no location is reached.
                display.setText("");
                shopDisplay.setText("");

                /* Location based classes that happen everytime a button is clicked.
                    Every button click adds 1 day and changes months if appropriate.
                    checks if the player has reached a river, town, or landmark.
                    Decreases distance of player form river, town, and landmarks.
                */
                location.incrementDay();
                location.setDistanceToLandmark(location.getDistanceToLandmark() - 20);
                location.setDistanceToRiver(location.getDistanceToRiver() - 20);
                location.setDistanceToTown(location.getDistanceToTown() - 20);

                location.atLandmark();


                //Displays town image and message if the person is at a town. If true resets distance to next landmark.
                if (location.getAtTown()) {
                    display.setText("You are at town " + location.whatTown());

                    title.setImageResource(R.drawable.fortkearney);
                    title.setVisibility(View.VISIBLE);
                    play.setVisibility(View.VISIBLE);
                    play.setText("Enter Town");
                    nextDay.setVisibility(View.INVISIBLE);
                    mp.pause();
                    tt.start();

                    title.bringToFront();
                    location.setDistanceToTown(200);
                    //location.setAtTown(false);
                }
                if (location.getAtRiver()) {
                    display.setText("You are at a river");

                    title.setImageResource(R.drawable.river);
                    title.setVisibility(View.VISIBLE);
                    play.setVisibility(View.VISIBLE);
                    play.setText("Cross River");
                    //nextDay.setVisibility(View.INVISIBLE);
                    mp.pause();
                    rs.start();

                    location.setDistanceToRiver(100);
                    //location.setAtRiver(false);
                }
                if (location.getAtLandmark()) {
                    display.setText("You are at " + location.whatLandmark());
                    location.setDistanceToLandmark(300);
                    location.setAtLandmark(false);
                }



                // restore 10 percent of the total health for resting over night
                overallHealth.startOfDayHealth();

                /* Find whether or not a random event occurs each day.
                    If someone gets bit by a snake the overall health goes up by 10.
                    If Indians help you find food the amount of food goes up 8 pounds.
                    If you take the wrong trail you have to back track using vital supplies.
                    If a random event takes place a prompt appears for the user to see what happened.
                 */
                if (re.snakeBite()) {
                    overallHealth.addHealth(10);
                    reBox.setText("You got bit by a snake");
                } else if (re.indiansHelpFindFood()) {
//                    Wagon.setFood(Wagon.getFood() + 8);
                    reBox.setText("Indians helped you find food");
                } else if (re.wrongTrail()) {

                    reBox.setText("OH-NO you took the wrong trail");
                } else {
                    reBox.setText("It was a normal day!");
                }

                //Depending on how many pounds of food is remaining the ration qualification changes.
                if (wagon.getFood() >= 1500) {
                    rations = "Filling";
                } else if (wagon.getFood() >= 1000) {
                    rations = "Meager";
                } else if (wagon.getFood() >= 5000) {
                    rations = "Bare Bones";
                } else {
                    rations = "Out of food";
                }

                // Using the rations found above determine how the health is effected.
                overallHealth.healthFromFood(rations);

                wagon.setFood(wagon.getFood() - 20);

                // display to the user the overall health of the entire group
                healthBox.setText(overallHealth.generalHealth());
                foodBox.setText(Double.toString(wagon.getFood()));
                date.setText(location.whatMonth() + " " + location.getDay());
            }
        });

    }
}
